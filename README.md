Spring

Core container
- beans
- core
- context
- expression

Testing
- test

Spring Container создает объекты классов, которые мы описываем. Данные объекты называются бинами
Чтобы спринг понял, какие объекты ему создавать, используется xml файл,
в котором содержится описание бинов, которые мы хотим создать.
Или bean-классы помечаются аннотациями

Типы контейнеров:
- BeanFactory
- ApplicationContext

По умолчанию все бины в спринг - синглтоны, т.е. когда мы запрашиваем бин у контейнера, он всегда возвращает один и тот же объект, созданный при инициализации

Prototype - new object on each getBean() call

Bean - обычный Java объект, созданный с помощью Spring

Scope - задает то, как Spring будет создавать бины
Scope по умолчанию - singleton
Scope prototype - создает новый объект при каждом вызове getBean(). Используется когда у бина есть изменяемые состояния (Stateful)

Bean lifecycle
Запускаем спринг приложение
-> Запускается спринг контейнер
-> Создается объект бина
-> в бин внедряются зависимости Dependency Injection
-> вызывается указанный init-method у бина
- метод, который вызвается при инициализации бина (инициализация ресурсов, обращение к внешним файлам, запуск БД)
-> бин готов к использованию
-> вызывается указанноый destroy-method
- метод, который вызывается при уничтожении бина при завершении приложения (очищение ресурсов, закрытие I/O потоков, закрытие подключения к БД)
-> остановка спринг приложения

Методы инициализации и уничтожения бина создаются в классе бина

Для бинов Prototype Spring не вызывает destroy метод,
пользователь сам должен вызвать его

==============
Annotations
==============
Аннотации - это специальный тип комментариев, с помощью которых можно
- передавать инструкции для JavaCompiler
- передавать инструкции для анализаторов исходного кода
- передавать метаданные, которые могут быть использованы приложением

Как Спринг работает с аннотациями?
Спринг сканирует все классы, находит аннотации и создает бины для этих классов

@Component - помечает класс, чтобы спринг создал для него бин (если не указать бин, то айди будет создан по названию класса)

@Autowired - навешивается на конструктор, мы больше не внедряем бин вручную, Спринг сам ищет подходящий бин и внедряет его

Как работает @Autowired?

Спринг сканирует классы с @Component
Спринг сканирует все созданные бины и проверяет, подходит ли хотя бы один бин в качестве зависимости там, где мы указали @Autowired
Если подходящий находится, он внедряется в качестве зависимости, если нет - ошибка
Если несколько подходящих бинов - ошибка, разрешаема

@Autowired подбирает подходящий бин по типу (класс или интерфейс)

@Autowired можно навесить на поле (даже на private), сеттер или конструктор

NoUniqueBeanDefinitionException - спринг не знает, какой из бинов внедрить
@Qualifier("beanId") - указывает id бина, который мы хотим внедрить

@Value - sets variable value
@Scope - задает то, как Спринг будет создавать бины (singleton/prototype)

@PostConstruct - применяется к init-method
@PreDestroy - применяется к destroy-method
у этих методов:
- любой модификатор доступа
- любой тип возвращаемого объекта (можно void, поскольку в любом случае нам не получить возвращаемый объект)
- название метода любое
- аргументов метода быть не должно

Конфигурация Spring приложения может быть настроена в:
- XML
- XML + Annotations
- Java Code + Annotations

@Configuration - аннотация помечает класс как конфигурационный класс для Спринг
- Ссылка на класс с конфигурацией теперь использует другой класс и указывает не на XML конфиг, а на конфиг класс:
AnnotationConfigApplicationContext context = new AnnotationConfigApplicationContext(SpringConfig.class);
- Для каждого XML тэга из springConfig.xml есть соответствующая аннотация:
@ComponentScan("org.springcourse")
- аналог <context:component-scan base-package="org.springcourse"/>
@Bean - применяется к конструктору класса бина, объявленному в конфиг классе
bean id = @Bean method name ("musicBean")
@Bean
public JazzMusic musicBean() {
return new JazzMusic();
}

@PropertySource("classpath:musicPlayer.properties") - применяется к классу SpringConfig
- аналог <context:property-placeholder location="classpath:musicPlayer.properties"/>